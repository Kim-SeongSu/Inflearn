# 03. 싱글톤 컨테이너

### 🔷 **싱글톤 패턴**
>ㅤ✅ **싱글톤 패턴은 클래스의 인스턴스가 딱 1개만 생성되는 것을 보장하는 디자인 패턴이다.** <br>

ㅤㅤ✔ **웹 애플리케이션에서의 DI가 갖는 문제점** <br>
ㅤㅤㅤ🔹 여러 고객이 동시에 요청하는 웹 애플리케이션에서의 DI는 요청 받을 때 마다 새로운 객체를 생성한다. **메모리 낭비 심함**<br>
ㅤㅤㅤ🔹 객체가 딱 1개만 생성되고, 공유하도록 하는 싱글톤 패턴을 사용하여 위의 문제를 해결할 수 있다. <br><br>

**💡 싱글톤 패턴 적용 예시**
```JAVA
package hello.core.singleton;

public class SingletonService {

    //1. static 영역에 객체를 딱 1개만 생성해둔다.
    private static final SingletonService instance = new SingletonService();

    //2. public으로 열어서 객체 인스턴스가 필요하면 이 static 메서드를 통해서만 조회하도록 허용한다.
    public static SingletonService getInstance() {
        return instance;
    }

    //3. 생성자를 private으로 선언해서 외부에서 new 키워드를 사용한 객체 생성을 못하게 막는다.
    private SingletonService() {
    }

    public void logic() {
        System.out.println("싱글톤 객체 로직 호출");
    }
}
```

ㅤㅤ✔ **싱글톤 패턴의 문제점** <br>
ㅤㅤㅤ🔹 구현하는 코드 자체가 길고, 내부 속성을 변경하거나 초기화 하기 어렵다. <br>
ㅤㅤㅤ🔹 private 생성자로 자식 클래스 만들기가 어렵다 (유연성이 떨어진다.) <br>
ㅤㅤㅤ🔹 클라이언트가 **구체 클래스에 의존해서 OCP 원칙(DIP)을 위반할 가능성이 높다** <br><br><br>

### 🔷 **싱글톤 컨테이너**

ㅤㅤ✔ **싱글톤 컨테이너** <br>
ㅤㅤㅤ🔹 **스프링 컨테이너는 싱글턴 패턴을 적용하지 않아도, 객체 인스턴스를 싱글톤으로 관리한다.** <br>
ㅤㅤㅤㅤㅤ❓**싱글톤 레지스트리**: 싱글톤 객체를 생성하고 관리하는 기능 <br>
ㅤㅤㅤ🔹 **싱글톤 패턴을 위한 지저분한 코드가 들어가지 않아도 된다.** <br>
ㅤㅤㅤ🔹 **DIP, OCP, 테스트, private 생성자로 부터 자유롭게 싱글톤을 사용할 수 있다.** <br><br>

<div align="center">
  <img width="100%" src="https://github.com/user-attachments/assets/d26838b3-a835-4b55-bc66-0210fa2f53a2">
</div> <br><br><br>

> [!CAUTION]
> **스프링의 기본 빈 등록 방식은 싱글톤이지만, 싱글톤 방식만 지원하는 것은 아니다.**

<br>

ㅤㅤ✔ **싱글톤 방식의 주의점** <br>
ㅤㅤㅤㅤ: 싱글톤 패턴이든, 스프링 같은 싱글톤 컨테이너를 사용하든, 객체 인스턴스를 하나만 생성해서 공유하는 <br>
ㅤㅤㅤㅤ 싱글톤 방식은 여러 클라이언트가 하나의 같은 객체 인스턴스를 공유하기 때문에 <br>
ㅤㅤㅤㅤ 싱글톤 객체는 상태를 유지(stateful)하게 설계하면 안된다. <br>

ㅤㅤㅤ🔹 **특정 클라이언트에 의존적인 필드가 있으면 안된다. (특정 클라이언트가 값을 변경할 수 있는 필드가 있으면 안됨)** <br>
ㅤㅤㅤ🔹 **가급적 읽기만 가능해야 한다** <br>
ㅤㅤㅤ🔹 **필드 대신에 자바에서 공유되지 않는, 지역변수, 파라미터, ThreadLocal 등을 사용해야 한다** <br><br><br>


### 🔷 **`@Configuration`과 싱글톤**

ㅤㅤ✔ **바이트코드 조작** <br>
ㅤㅤㅤ🔹 스프링 컨테이너는 싱글톤 레지스트리다. 따라서 **스프링 빈이 싱글톤이 되도록 보장**해주어야 한다 <br>
ㅤㅤㅤ🔹 하지만 스프링이 **자바 코드**까지 싱글톤처럼 (각 객체 별로) 중복 실행이 안되도록 설정하기 어렵다. <br>
ㅤㅤㅤ🔹 **스프링은 클래스의 바이트코드를 조작하는 라이브러리(`CGLIB`)를 사용한다. (`@Configuration`에 `CGLIB` 포함됨)** <br>
ㅤㅤㅤㅤㅤ❗**`@Configuration`을 적용하지 않고 `@Bean`만 적용하면 스프링 빈으로 등록은 되지만, 싱글톤을 보장하지는 않는다** <br>
ㅤㅤㅤ🔹 바이트코드 조작 라이브러리를 사용해서 'AppConfig' 클래스를 **상속받은 임의의 다른 클래스**를 만들어 **스프링 빈으로 등록** <br>
ㅤㅤㅤㅤㅤ- `@Bean`이 붙은 메서드마다 이미 스프링 빈이 존재하면 존재하는 빈을 반환 <br>
ㅤㅤㅤㅤㅤ- 스프링 빈이 없으면 생성해서 스프링 빈으로 등록하고 반환하는 코드가 **동적**으로 만들어짐 ( **→ 싱글톤 보장** )<br><br>

ㅤㅤ✅ **스프링 설정 정보는 항상 `@Configuration`을 사용하자!** <br><br><br>


<!--
공백문자: "ㅤ" or &nbsp;
### 🔷 ****
>ㅤ✅ **** <br>
ㅤㅤ:  <br>
ㅤㅤㅤex) <br>
ㅤㅤ✔ **** <br>
ㅤㅤㅤ🔹 **** <br>
ㅤㅤㅤㅤㅤ- **** <br>
➡️
ㅤㅤㅤㅤㅤex) <br>
ㅤㅤ❗ <br>
ㅤㅤ❓ <br>
ㅤㅤ✅ <br>
ㅤㅤㅤㅤ**▪️** <br>
ㅤㅤㅤㅤ**▫️** <br>
ㅤㅤ**1️⃣** <br>
ㅤㅤ**2️⃣** <br>
ㅤㅤ**3️⃣** <br>
ㅤㅤ**4️⃣** <br>
ㅤㅤ**5️⃣** <br>
ㅤㅤ**🤔** <br>
> [!NOTE]  
> [!TIP]
> [!IMPORTANT]  
> [!WARNING]  
> [!CAUTION]


**💡 예시**
```JAVA

```


<details><summary>💡예시 코드</summary>

```JAVA

```
</details>

<br>

<div align="center">
  <img width="70%" src="">
</div> <br><br>


<div align="center">
|****|****|
|:--:|:--:|
|||
</div> 

[^1]
-->
